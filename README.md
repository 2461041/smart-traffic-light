# 스마트 점멸 신호등 구현

## 1. 연구배경 및 필요성(중요성)

점멸신호란 도로에서 신호등이 평소처럼 작동하다가 일정한 시간에 일정한 속도로 신호등이 켜졌다 꺼졌다 반복하는 신호체계이다. 교통량이 급감하는 심야나 휴일 시간대에 보행자 및 차량이 적은 횡단보도나 교차로 등에서 운영되고 있다. 어떤 도로에서는 일정 시간에 점멸신호로 바뀌기도 하고, 어떤 도로는 상시 점멸신호로 운영되고 있다. 점멸신호는 신호 대기로 인한 불필요한 대기 시간을 절약하고, 불필요한 신호 변경을 줄여 교차로의 혼잡을 줄인다. 또한 24시간 작동하던 상시 신호 변경을 최소화하여 전력 소비를 줄여 에너지를 절약하고, 신호 주기를 계산하는 복잡한 장치가 필요 없어 유지 비용이 낮아지기 때문에 점멸신호를 사용하고 있다. 하지만 현재의 점멸신호는 보행자 등장에 적절한 대응을 하지 못하기 때문에 교통사고와 같은 안전 문제를 초래한다. 하지만 야간 시간대나 통행량이 적은 도로에서 사용되는 현재의 점멸신호는 보행자 등장에 적절한 대응을 하지 못하기 때문에 교통사고와 같은 안전 문제를 초래하고 보행자와 운전자의 안전을 보장하는데 한계가 있다. 실제로 매년 점멸 신호등의 교통사고 비율이 높아지고 있다. 따라서 본 연구에서는 초음파 센서를 이용하여 보행자를 감지할 수 있는 신호등 시스템을 개발하여 보행자와 운전자의 안전을 확보하고자 한다. 이 신호등 시스템은 보행자 인식 전과 후에 따라 점멸신호였던 차량 신호등과 횡단보도의 신호등을 제어한다.   

## 2. 관련기술의 현황
  본 연구의 국내의 기술수준과 국외의 기술수준을 기록합니다. 
점멸신호는 이미 교통 흐름을 방해하지 않으면서 안전성을 유지할 수 있는 방법으로 교통량이 적은 시간대와 교차로의 복잡도가 낮은 지역에서 주로 사용되며 널리 활용되고 있다. 하지만 현재의 점멸신호는 보행자나 차량의 존재와 관계없이 일정한 주기로 점멸신호를 유지하거나 교차로의 계산된 신호 주기에 따라 고정적으로 동작한다. 즉, 보행자나 차량이 횡단보도나 교차로를 지나갈 때에도 점멸신호를 유지한다. 이러한 기존의 점멸신호는 보행자를 감지하지 못하기 때문에 보행자 등장에 적절한 대응을 하지 못한다. 또한 현재의 점멸신호는 차량 중심으로 설계되어 사고 발생 위험이 높기 때문에 보행자와 운전자의 안전에 한계가 있다. 따라서 이를 보완하기 위해 보행자를 감지하여 신호등을 제어하는 시스템의 개발이 필요하다.

## 3. 기대효과 및 활용
 - 보행자와 운전자의 안전성 강화
   - 초음파 센서로 보행자를 감지하여 신호등을 제어함으로써 보행자와 운전자의 안전성을 강화할 수 있다.
- 교통 효율성 향상
  - 불필요한 신호 변경을 줄여 교차로의 혼잡을 줄여 차량 흐름을 원활하게 하고, 신호 대기로 인한 불필요한 대기 시간을 절약할 수 있다.
- 에너지 절감 효과
  - 일반 신호 체계는 24시간 작동하며 에너지 소모가 크지만, 점멸 신호는 단순한 패턴으로 작동하기 때문에 에너지 소비를 줄일 수 있다. 
- 유지 비용 절감 효과
  - 신호 주기를 계산하는 복잡한 장치가 필요 없어 유지 비용이 낮아지며, 불필요한 신호 변경을 줄이면 신호등의 수명이 연장되기 때문에 유지 비용을 절약할 수 있다.
- 대기오염 개선
  - 불필요한 정차와 재출발을 줄일 수 있기 때문에 대기오염을 개선할 수 있다.
- 기존의 점멸 신호등 시스템보다 교통사고 감소
- 상품화 후 수출증대

## 4. 목표
기존의 점멸신호등에 보행자를 감지하여 횡단보도 신호등과 차량 신호등을 제어하는 시스템 개발 
- 보행자 감지 장치 개발
- 신호등의 제어장치 개발
- 신호등 알고리즘 개발

## 5. 내용
- 보행자 감지 장치 제작
- 신호등 제어장치 설계 및 제작
- 신호등 알고리즘 설계
- 신호등의 시운전

![nonmqe01](https://github.com/2461041/smart-traffic-light/blob/main/noname01.png)
![noname02](https://github.com/2461041/smart-traffic-light/blob/main/noname02.png)


## 6. 구현 방법
#### (1) 구현방법
1. 핀과 변수 설정
    - 핀 설정
    - 보행자 감지 및 신호 제어 변수 
2. setup 함수
    - LED 핀 모드 설정
    - 초음파 센서 모드 설정
    - 초기 LED 상태 설정
3. loop 함수
    - 초음파 센서로 거리 측정
    - 보행자 감지
    - LED 제어

#### (2) 추진체계

   1. 핀과 변수 설정
   - 핀 설정

   ![c1](https://github.com/2461041/smart-traffic-light/blob/main/c01.png)

    - trigPin과 echoPin: 초음파 센서의 트리거(Trig) 핀과 반사된 초음파를 수신하는 Echo 핀을 설정합니다.   
    - carRedLED, carYellowLED, carGreenLED: 차량 신호등의 빨간불, 노란불, 초록불을 제어하는 핀입니다.  
    - pedestrianRedLED, pedestrianGreenLED: 보행자 신호등의 빨간불, 초록불을 제어하는 핀입니다.


- 보행자 감지 및 신호 제어 변수
 
![c2](https://github.com/2461041/smart-traffic-light/blob/main/c02.png)

    - lastDetectionTime: 보행자가 처음으로 감지된 시간을 기록하여 신호등 변경을 제어합니다.
    - pedestrianGreenStartTime, carGreenStartTime: 각각 보행자 신호등과 차량 신호등이 초록불로 변경된 시간을 기록하여, 10초 동안의 타이머를 관리합니다.
    - pedestrianDetected: 보행자가 감지되었는지 여부를 나타냅니다.
    - signalChanged: 신호등이 이미 변경되었는지 여부를 추적합니다.
    - carGreenChanged: 차량 신호등의 초록불이 변경된 후에 체크하는 변수입니다.

2. stup 함수
  - 핀모드 설정
  - 초음파 센서 모드 설정]
  - 초기 LED 상태 설정

  ![c03](https://github.com/2461041/smart-traffic-light/blob/main/c03.png)

    - pinMode를 사용하여 신호등과 초음파 센서의 핀을 출력(OUTPUT) 또는 입력(INPUT)으로 설정합니다.
    - 초기 상태에서는 보행자 신호등은 빨간불로, 차량 신호등은 모두 꺼짐 상태로 설정됩니다.


3. loop 함수

![c04](https://github.com/2461041/smart-traffic-light/blob/main/c04.png)

    - 초음파 센서를 이용해 보행자의 거리를 측정합니다. trigPin에 신호를 보내고, echoPin에서 돌아오는 신호를 받아 시간을 측정합니다. 그 후 거리를 계산합니다.
    - 보행자가 50cm 이내에 있으면 pedestrianDetected를 true로 설정하여 보행자가 감지된 것을 인식합니다.
   3-5. 보행자 신호등 제어

 ![c05](https://github.com/2461041/smart-traffic-light/blob/main/c05.png)

    - 보행자가 감지된 후 5초가 지나면, 보행자 신호등을 초록불로 변경하고 차량 신호등을 빨간불로 설정합니다.
    - signalChanged를 true로 설정하여 신호등이 변경되었음을 기록하고, 보행자 신호등이 초록불로 변경된 시간을 pedestrianGreenStartTime에 저장합니다.

    
   3-6. 차량 신호등 초록색 전환

 ![c6](https://github.com/2461041/smart-traffic-light/blob/main/c06.png)

    - 보행자 신호등이 초록불로 10초 동안 유지되면, 차량 신호등을 초록불로 변경합니다.
    - 차량 신호등이 초록불로 변경된 시간을 carGreenStartTime에 저장하고, carGreenChange d를 true로 설정하여 차량 신호등이 변경되었음을 기록합니다.
    
   3-7. 차량 신호등 10초 후 초기화

 ![c07](https://github.com/2461041/smart-traffic-light/blob/main/c07.png)

    - 차량 신호등이 초록불로 10초 동안 유지되면, 모든 신호등을 초기 상태로 돌아가게 합니다.
    - signalChanged와 carGreenChanged를 false로 설정하여 신호등 상태를 리셋합니다.
 
   3-8. 차량 신호등 노란불 점멸

 ![c08](https://github.com/2461041/smart-traffic-light/blob/main/c08.png) 

     - 보행자가 감지되지 않은 경우, 차량 신호등의 노란불이 1초 간격으로 깜빡입니다.
     
   3-9. 보행자 감지되지 않으면 초기 상태 유지
   
 ![c09](https://github.com/2461041/smart-traffic-light/blob/main/c09.png)

     - 보행자가 감지되지 않으면 신호등은 초기 상태로 돌아갑니다. 보행자 신호등은 빨간불이 켜지고, 차량 신호등은 모두 꺼집니다.
